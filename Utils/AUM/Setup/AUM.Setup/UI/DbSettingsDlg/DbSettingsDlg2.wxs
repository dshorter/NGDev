<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Fragment>
    <PropertyRef Id="MAINT_SQL_LOGIN" />
    <PropertyRef Id="MAINT_SQL_PASSWORD" />

    <CustomActionRef Id="TestDbConnection" />
    <CustomActionRef Id="TestArchiveDbConnection" />

    <UI>
      <Dialog Id="DbSettingsDlg2" Width="370" Height="270" Title="!(loc.DbSettingsDlg_Title)">
        <Control Id="Description" Type="Text" X="25" Y="23" Width="300" Height="15" Transparent="yes" NoPrefix="yes" Text="!(loc.DbSettingsDlgDescription)" />
        <Control Id="Title" Type="Text" X="15" Y="6" Width="250" Height="15" Transparent="yes" NoPrefix="yes" Text="!(loc.DbSettingsDlgTitle)" />
        <Control Id="BannerBitmap" Type="Bitmap" X="0" Y="0" Width="370" Height="44" TabSkip="no" Text="!(loc.DbSettingsDlgBannerBitmap)" />
        <Control Id="BannerLine" Type="Line" X="0" Y="44" Width="370" Height="0" />
        <Control Id="BottomLine" Type="Line" X="0" Y="234" Width="370" Height="0" />

        <Control Id="AdminUserTitle" Type="Text" Width="70" Height="17" X="20" Y="50" Text="!(loc.DbSettingsDlgAdminUser)" />
        <Control Id="AdminUser" Type="Edit" Width="240" Height="15" X="105" Y="50" Property="MAINT_SQL_LOGIN" />
        <Control Id="AdminPasswordTitle" Type="Text" Width="70" Height="17" X="20" Y="70" Text="!(loc.DbSettingsDlgAdminPassword)" />
        <Control Id="AdminPassword" Type="Edit" Width="240" Height="15" X="105" Y="70" Property="MAINT_SQL_PASSWORD" Password="yes" />

        <Control Id="DbSeparator" Type="Line" X="30" Y="95" Width="310" Height="0" />

        <Control Id="ServerTitle" Type="Text" Width="100" Height="17" X="20" Y="100" Text="!(loc.DbSettingsDlgServer)" />
        <Control Id="Service" Type="Edit" Width="180" Height="15" X="130" Y="100" Property="DBSERVER">
          <Condition Action="disable">DBSERVER_FOUND</Condition>
          <Condition Action="enable">
            <![CDATA[Not DBSERVER_FOUND Or "" = DBSERVER_FOUND Or (DbConnection_Valid And DbConnection_Valid <> "1")]]>
          </Condition>
        </Control>
        <Control Id="DatabaseTitle" Type="Text" Width="100" Height="17" X="20" Y="120" Text="!(loc.DbSettingsDlgDatabase)" />
        <Control Id="Database" Type="Edit" Width="180" Height="15" X="130" Y="120" Property="SQLDATABASE">
          <Condition Action="disable">SQLDATABASE_FOUND</Condition>
          <Condition Action="enable">
            <![CDATA[Not SQLDATABASE_FOUND Or "" = SQLDATABASE_FOUND Or (DbConnection_Valid And DbConnection_Valid <> "1")]]>
          </Condition>
        </Control>

        <Control Id="CheckConnection" Type="PushButton" X="100" Y="140" Width="100" Height="17" Text="!(loc.DbSettingsDlgCheckConnectionButton)">
          <Condition Action="disable">
            <![CDATA[(Not SQLDATABASE Or "" = SQLDATABASE) And (Not DBSERVER Or "" = DBSERVER)]]>
          </Condition>
          <Condition Action="enable">
            <![CDATA[SQLDATABASE And "" <> SQLDATABASE Or DBSERVER And "" <> DBSERVER]]>
          </Condition>
          <Publish Event="DoAction" Value="TestDbConnection" Order="1">
            <![CDATA[SQLDATABASE And "" <> SQLDATABASE Or DBSERVER And "" <> DBSERVER]]>
          </Publish>
          <Publish Event="NewDialog" Value="DbSettingsDlg" Order="10">1</Publish>
        </Control>
        <Control Id="TestResult_Success" Type="Icon" IconSize="32" X="320" Y="100" Width="34" Height="34" Text="SuccessImg" FixedSize="yes" Hidden="yes">
          <Condition Action="hide"><![CDATA[DbConnection_Valid <> "1"]]></Condition>
          <Condition Action="show"><![CDATA[DbConnection_Valid = "1"]]></Condition>
        </Control>
        <Control Id="TestResult_Failure" Type="Icon" IconSize="32" X="320" Y="100" Width="34" Height="34" Text="FailureImg" FixedSize="yes" Hidden="yes">
          <Condition Action="hide"><![CDATA[DbConnection_Valid = "1"]]></Condition>
          <Condition Action="show"><![CDATA[DbConnection_Valid And DbConnection_Valid <> "1"]]></Condition>
        </Control>

        <Control Id="ArchiveServerTitle" Type="Text" Width="100" Height="17" X="20" Y="165" Text="!(loc.DbSettingsDlgArchiveServer)" />
        <Control Id="ArchiveService" Type="Edit" Width="180" Height="15" X="130" Y="165" Property="ARCHDBSERVER">
          <Condition Action="disable">ARCHDBSERVER_FOUND</Condition>
          <Condition Action="enable">
            <![CDATA[Not ARCHDBSERVER_FOUND Or "" = ARCHDBSERVER_FOUND Or (ArchDbConnection_Valid And ArchDbConnection_Valid <> "1")]]>
          </Condition>
        </Control>
        <Control Id="ArchiveDatabaseTitle" Type="Text" Width="100" Height="17" X="20" Y="185" Text="!(loc.DbSettingsDlgArchiveDatabase)" />
        <Control Id="ArchiveDatabase" Type="Edit" Width="180" Height="15" X="130" Y="185" Property="ARCHDATABASE">
          <Condition Action="disable">ARCHDATABASE_FOUND</Condition>
          <Condition Action="enable">
            <![CDATA[Not ARCHDATABASE_FOUND Or "" = ARCHDATABASE_FOUND Or (ArchDbConnection_Valid And ArchDbConnection_Valid <> "1")]]>
          </Condition>
        </Control>

        <Control Id="CheckArchiveConnection" Type="PushButton" X="100" Y="205" Width="100" Height="17" Text="!(loc.DbSettingsDlgCheckConnectionButton)">
          <Condition Action="disable">
            <![CDATA[(Not ARCHDATABASE Or "" = ARCHDATABASE) And (Not ARCHDBSERVER Or "" = ARCHDBSERVER)]]>
          </Condition>
          <Condition Action="enable">
            <![CDATA[ARCHDATABASE And "" <> ARCHDATABASE Or ARCHDBSERVER And "" <> ARCHDBSERVER]]>
          </Condition>
          <Publish Event="DoAction" Value="TestArchiveDbConnection" Order="1">
            <![CDATA[ARCHDATABASE And "" <> ARCHDATABASE Or ARCHDBSERVER And "" <> ARCHDBSERVER]]>
          </Publish>
          <Publish Event="NewDialog" Value="DbSettingsDlg" Order="10">1</Publish>
        </Control>
        <Control Id="TestArchiveResult_Success" Type="Icon" IconSize="32" X="320" Y="165" Width="34" Height="34" Text="SuccessImg" FixedSize="yes" Hidden="yes">
          <Condition Action="hide"><![CDATA[ArchDbConnection_Valid <> "1"]]></Condition>
          <Condition Action="show"><![CDATA[ArchDbConnection_Valid = "1"]]></Condition>
        </Control>
        <Control Id="TestArchiveResult_Failure" Type="Icon" IconSize="32" X="320" Y="165" Width="34" Height="34" Text="FailureImg" FixedSize="yes" Hidden="yes">
          <Condition Action="hide"><![CDATA[ArchDbConnection_Valid = "1"]]></Condition>
          <Condition Action="show"><![CDATA[ArchDbConnection_Valid And ArchDbConnection_Valid <> "1"]]></Condition>
        </Control>

        <Control Id="Next" Type="PushButton" X="236" Y="243" Width="56" Height="17" Default="yes" Text="!(loc.WixUINext)">
          <Publish Event="DoAction" Value="TestDbConnection" Order="1">1</Publish>
          <Publish Event="DoAction" Value="TestArchiveDbConnection" Order="3">
            <![CDATA[(Not SQLDATABASE Or "" = SQLDATABASE) And (Not DBSERVER Or "" = DBSERVER) Or DbConnection_Valid = "1"]]>
          </Publish>
          <Publish Property="ErrorConnectionText" Value="!(loc.ErrorConnectionText_ConnectionTestFailed)" Order="5">
            <![CDATA[(SQLDATABASE And "" <> SQLDATABASE Or DBSERVER And "" <> DBSERVER And DbConnection_Valid <> "1") Or (ARCHDATABASE And "" <> ARCHDATABASE Or ARCHDBSERVER And "" <> ARCHDBSERVER And DbConnection_Valid <> "1")]]>
          </Publish>
          <Publish Event="SpawnDialog" Value="ErrorConnectionDlg" Order="6">
            <![CDATA[(SQLDATABASE And "" <> SQLDATABASE Or DBSERVER And "" <> DBSERVER And DbConnection_Valid <> "1") Or (ARCHDATABASE And "" <> ARCHDATABASE Or ARCHDBSERVER And "" <> ARCHDBSERVER And DbConnection_Valid <> "1")]]>
          </Publish>
          <Publish Property="AVR_SERVICE" Value="[AvrServiceNotPresentValue]" Order="7">1</Publish>
          <Publish Event="DoAction" Value="FillAvrServices" Order="8">1</Publish>
        </Control>
        <Control Id="Back" Type="PushButton" X="180" Y="243" Width="56" Height="17" Text="!(loc.WixUIBack)" />
        <Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Cancel="yes" Text="!(loc.WixUICancel)">
          <Publish Event="SpawnDialog" Value="CancelDlg">1</Publish>
        </Control>
      </Dialog>
    </UI>
  </Fragment>
</Wix>