<?xml version="1.0" encoding="UTF-8"?>

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Fragment>
    <UI Id="WixUI_AUM">
      <TextStyle Id="WixUI_Font_Normal" FaceName="Tahoma" Size="8" />
      <TextStyle Id="WixUI_Font_Bigger" FaceName="Tahoma" Size="12" />
      <TextStyle Id="WixUI_Font_Title" FaceName="Tahoma" Size="9" Bold="yes" />

      <Property Id="DefaultUIFont" Value="WixUI_Font_Normal" />
      <Property Id="WixUI_Mode" Value="InstallDir" />
      <TextStyle Id="WixUI_Font_Emphasized" FaceName="!(loc.Advanced_Font_FaceName)" Size="!(loc.Advanced_Font_Emphasized_Size)" Bold="yes" />

      <DialogRef Id="ErrorDlg" />
      <DialogRef Id="CustomFatalError" />
      <DialogRef Id="FilesInUse" />
      <DialogRef Id="MsiRMFilesInUse" />
      <DialogRef Id="PrepareDlg" />
      <DialogRef Id="ProgressDlg" />
      <DialogRef Id="ResumeDlg" />
      <DialogRef Id="CustomUserExit" />

      <Publish Dialog="CustomExitDialog" Control="Finish" Event="EndDialog" Value="Return" Order="999">1</Publish>

      <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="Configuration.MachineLevelDlg">NOT Installed And Not WIX_UPGRADE_DETECTED</Publish>
      <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="VerifyReadyDlg">Installed AND PATCH Or WIX_UPGRADE_DETECTED</Publish>
      
      <Publish Dialog="Configuration.MachineLevelDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg" Order="1">1</Publish>
      <Publish Dialog="Configuration.MachineLevelDlg" Control="Next" Event="NewDialog" Value="Configuration.BackupsDriveDlg" Order="100">1</Publish>

      <Publish Dialog="Configuration.BackupsDriveDlg" Control="Back" Event="NewDialog" Value="Configuration.MachineLevelDlg">1</Publish>
      <Publish Dialog="Configuration.BackupsDriveDlg" Control="Next" Event="NewDialog" Value="Configuration.MiscDlg" Order="100">1</Publish>

      <Publish Dialog="Configuration.MiscDlg" Control="Back" Event="NewDialog" Value="Configuration.BackupsDriveDlg">1</Publish>
      <Publish Dialog="Configuration.MiscDlg" Control="Next" Event="NewDialog" Value="DbSettingsDlg" Order="100">
        <![CDATA[MiscConfigurationValid = 1 And MACHINE_LEVEL <> 6]]>
      </Publish>
      <Publish Dialog="Configuration.MiscDlg" Control="Next" Event="NewDialog" Value="Configuration.UpgradeUrlsDlg" Order="101">
        <![CDATA[MiscConfigurationValid = 1 And MACHINE_LEVEL = 6]]>
      </Publish>

      <?foreach num in ;2?>
      <Publish Dialog="DbSettingsDlg$(var.num)" Control="Back" Event="NewDialog" Value="Configuration.MiscDlg">1</Publish>
      <Publish Dialog="DbSettingsDlg$(var.num)" Control="Next" Event="NewDialog" Value="AvrSvcSettingsDlg" Order="100">
        <![CDATA[AvrServiceConfigurationRequired And DbConnection_Valid = "1" And ((Not ARCHDATABASE Or "" = ARCHDATABASE) And (Not ARCHDBSERVER Or "" = ARCHDBSERVER) Or ArchDbConnection_Valid = "1")]]>
      </Publish>
      <Publish Dialog="DbSettingsDlg$(var.num)" Control="Next" Event="NewDialog" Value="Configuration.UpgradeUrlsDlg" Order="102">
        <![CDATA[Not AvrServiceConfigurationRequired And ((Not SQLDATABASE Or "" = SQLDATABASE) And (Not DBSERVER Or "" = DBSERVER) Or DbConnection_Valid = "1") And ((Not ARCHDATABASE Or "" = ARCHDATABASE) And (Not ARCHDBSERVER Or "" = ARCHDBSERVER) Or ArchDbConnection_Valid = "1")]]>
      </Publish>
      <?endforeach?>

      <Publish Dialog="AvrSvcSettingsDlg" Control="Back" Event="NewDialog" Value="DbSettingsDlg" Order="1">1</Publish>
      <Publish Dialog="AvrSvcSettingsDlg" Control="Next" Event="NewDialog" Value="Configuration.UpgradeUrlsDlg" Order="101">1</Publish>

      <Publish Dialog="Configuration.UpgradeUrlsDlg" Control="Back" Event="NewDialog" Value="DbSettingsDlg" Order="100">
        <![CDATA[Not AvrServiceConfigurationRequired And MACHINE_LEVEL <> 6]]>
      </Publish>
      <Publish Dialog="Configuration.UpgradeUrlsDlg" Control="Back" Event="NewDialog" Value="AvrSvcSettingsDlg" Order="101">
        <![CDATA[AvrServiceConfigurationRequired And MACHINE_LEVEL <> 6]]>
      </Publish>
      <Publish Dialog="Configuration.UpgradeUrlsDlg" Control="Back" Event="NewDialog" Value="Configuration.MiscDlg" Order="102">
        <![CDATA[MACHINE_LEVEL = 6]]>
      </Publish>
      <Publish Dialog="Configuration.UpgradeUrlsDlg" Control="Next" Event="NewDialog" Value="VerifyReadyDlg" Order="100">
        <![CDATA[MAIN_URL_VALID = "1" And (SECONDARY_URL_VALID = "1" Or SecureUrl <> "1")]]>
      </Publish>

      <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="Configuration.UpgradeUrlsDlg" Order="4">
        <![CDATA[Not Installed And Not WIX_UPGRADE_DETECTED]]>
      </Publish>
      <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="MaintenanceWelcomeDlg" Order="5">Installed AND NOT PATCH</Publish>
      <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg" Order="6">Installed AND (PATCH Or WIX_UPGRADE_DETECTED)</Publish>

      <!-- Maintenance dlg type is disabled while repair is anallowed -->
      <!--<Publish Dialog="MaintenanceWelcomeDlg" Control="Next" Event="NewDialog" Value="MaintenanceTypeDlg">1</Publish>-->
      <Publish Dialog="MaintenanceWelcomeDlg" Control="Next" Property="WixUI_InstallMode" Value="Remove" Order="1">Not WIX_UPGRADE_DETECTED</Publish>
      <Publish Dialog="MaintenanceWelcomeDlg" Control="Next" Event="NewDialog" Value="VerifyReadyDlg" Order="100">1</Publish>

      <!--<Publish Dialog="MaintenanceTypeDlg" Control="RepairButton" Event="NewDialog" Value="VerifyReadyDlg">1</Publish>
      <Publish Dialog="MaintenanceTypeDlg" Control="RemoveButton" Event="NewDialog" Value="VerifyReadyDlg">1</Publish>-->
      <Publish Dialog="MaintenanceTypeDlg" Control="Back" Event="NewDialog" Value="MaintenanceWelcomeDlg">1</Publish>

      <Property Id="ARPNOMODIFY" Value="1" />
    </UI>

    <UIRef Id="WixUI_Common" />
  </Fragment>
</Wix>